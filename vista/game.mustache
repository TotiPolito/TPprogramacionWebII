<html>
<head>
    <title>Game</title>
    <link rel="stylesheet" href="{{BASE_URL}}/public/style/game.css">
    <link rel="stylesheet" href="{{BASE_URL}}/public/style/style.css">
    <link rel="stylesheet" href="{{BASE_URL}}/public/style/headerFooter.css">
</head>
<body>

<h2  style="background-color: {{color}};">Categor√≠a: {{categoria}}</h2>
<img src="{{BASE_URL}}/public/{{pregunta.imagen}}" alt="imagen de la pregunta" class="pregunta_imagen">
<p>{{pregunta.descripcion}}</p>

<form id="respuestaForm" action="{{BASE_URL}}/index.php?controller=Game&method=responder" method="POST">
    <input type="hidden" name="idPregunta" value="{{pregunta.id}}">
    <input type="hidden" name="idRespuesta" id="idRespuesta">
</form>

<div class="respuestas">
    {{#respuestas}}
        <button type="button"
                onclick="enviarRespuesta({{id}}, this)"
                data-correcta="{{#estado}}1{{/estado}}{{^estado}}0{{/estado}}">
            {{descripcion}}
        </button>
    {{/respuestas}}
</div>

<script src="{{BASE_URL}}/public/js/dinamicStyle.js"></script>

<div id="timer">Tiempo restante: <span id="tiempo">10</span> segundos</div>

<script>
    let tiempo = 10;
    const contador = document.getElementById("tiempo");
    const form = document.getElementById("respuestaForm");
    const inicio = Date.now();

    // guardamos inicio para backend
    const inputTiempoInicio = document.createElement("input");
    inputTiempoInicio.type = "hidden";
    inputTiempoInicio.name = "tiempoInicio";
    inputTiempoInicio.value = inicio;
    form.appendChild(inputTiempoInicio);

    // cuenta regresiva
    const interval = setInterval(() => {
        tiempo--;
        contador.textContent = tiempo;

        if (tiempo <= 0) {
            clearInterval(interval);
            enviarTimeout();
        }
    }, 1000);

    // üîπ funci√≥n √∫nica para colorear y enviar
    function enviarRespuesta(idRespuesta, botonSeleccionado) {
        clearInterval(interval); // detiene el timer
        const esCorrecta = botonSeleccionado.getAttribute('data-correcta') === '1';

        // color visual
        if (esCorrecta) {
            botonSeleccionado.classList.add('correcta');
        } else {
            botonSeleccionado.classList.add('incorrecta');
        }

        // desactivar botones
        document.querySelectorAll('.respuestas button').forEach(b => b.disabled = true);

        // esperar 1 segundo y enviar
        setTimeout(() => {
            document.getElementById("idRespuesta").value = idRespuesta;
            form.submit();
        }, 1000);
    }

    function enviarTimeout() {
        document.getElementById("idRespuesta").value = 0;
        const inputTimeout = document.createElement("input");
        inputTimeout.type = "hidden";
        inputTimeout.name = "timeout";
        inputTimeout.value = "true";
        form.appendChild(inputTimeout);
        form.submit();
    }
</script>
</body>
</html>
